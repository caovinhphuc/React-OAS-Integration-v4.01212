name: ğŸ“š Deploy Documentation

on:
  push:
    branches:
      - main
      - develop
    paths:
      - "*.md"
      - "docs/**"
      - ".github/workflows/docs-deploy.yml"
  workflow_dispatch:

jobs:
  deploy-docs:
    runs-on: ubuntu-latest

    permissions:
      contents: write
      pages: write
      id-token: write

    concurrency:
      group: "pages"
      cancel-in-progress: false

    steps:
      - name: ğŸ“¥ Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: ğŸ”§ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "20"
          cache: "npm"

      - name: ğŸ“¦ Install dependencies
        run: npm ci

      - name: ğŸ“š Build documentation
        run: |
          mkdir -p dist-docs
          mkdir -p dist-docs/guides

          # Copy markdown files
          cp -v ARCHITECTURE_GUIDE.md dist-docs/ || true
          cp -v ARCHITECTURE.md dist-docs/ || true
          cp -v README.md dist-docs/ || true
          cp -v DEPLOYMENT_GUIDE.md dist-docs/ || true
          cp -v DEVELOPMENT_TOOLS_SETUP.md dist-docs/guides/ || true
          cp -v BUNDLE_OPTIMIZATION_GUIDE.md dist-docs/guides/ || true
          cp -v GITHUB_SETUP_GUIDE.md dist-docs/guides/ || true

          # Copy docs folder
          cp -rv docs/* dist-docs/ 2>/dev/null || true

      - name: ğŸ” Validate documentation
        run: |
          echo "ğŸ“‹ Documentation files created:"
          find dist-docs -name "*.md" -type f | wc -l
          echo "Total markdown files:"
          find dist-docs -name "*.md" -type f

      - name: ğŸš€ Deploy to GitHub Pages
        uses: actions/upload-pages-artifact@v2
        with:
          path: "dist-docs"

      - name: ğŸ“¤ Publish to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v2

      - name: âœ… Document deployment success
        run: |
          echo "âœ… Documentation deployed successfully!"
          echo "ğŸ“ URL: ${{ steps.deployment.outputs.page_url }}"

      - name: ğŸ“¢ Notify deployment
        if: always()
        run: |
          echo "ğŸ“š Documentation Deployment Summary:"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "âœ… Status: Success"
          echo "ğŸ“ Output: dist-docs"
          echo "ğŸ”— GitHub Pages URL: https://${{ github.repository_owner }}.github.io/${{ github.event.repository.name }}"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

  notify:
    needs: deploy-docs
    runs-on: ubuntu-latest
    if: always()

    steps:
      - name: ğŸ“§ Log deployment result
        run: |
          if [ "${{ needs.deploy-docs.result }}" = "success" ]; then
            echo "âœ… Documentation deployment completed successfully!"
          else
            echo "âŒ Documentation deployment failed!"
          fi
